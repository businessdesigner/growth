<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Exporter</title>
<style>
  body { font-family: -apple-system, sans-serif; background: #f7f7f5; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
  .card { background: white; padding: 40px; border-radius: 12px; border: 1px solid #edeef0; text-align: center; max-width: 400px; }
  .btn-export { background: #2383e2; color: white; padding: 15px 30px; border-radius: 8px; border: none; font-size: 16px; font-weight: 600; cursor: pointer; }
</style>
</head>
<body>
<div class="card">
  <h2>Step 2: Generate JSON</h2>
  <p>點擊按鈕獲取最新資料庫清單，並儲存為 data.json。</p>
  <button id="exportBtn" class="btn-export">Download data.json</button>
  <p><a href="upload.html" style="color: #888; text-decoration: none; font-size: 13px;">← Back to Upload</a></p>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
const supabase = createClient("https://cvuigmevznxkgnmleuta.supabase.co", "sb_publishable_jbiNfw9ST_LSxlYuDNR3Ag_RymggO6q")

document.getElementById('exportBtn').onclick = async () => {
  const { data } = await supabase.from("files").select("*");
  const dataToExport = data.map(f => {
    const { data: { publicUrl } } = supabase.storage.from("Files").getPublicUrl(f.storage_path);
    return { display_name: f.display_name, category: f.category, emoji: f.emoji, url: publicUrl };
  });
  const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = window.URL.createObjectURL(blob);
  a.download = 'data.json';
  a.click();
};
</script>
</body>
</html>