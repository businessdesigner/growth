<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Admin - Library Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg: #f7f7f5; --text: #37352f; --border: #edeef0; --accent: #2383e2; --info: #ebf5ff; --secondary: #91918e; }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
  
  /* Navigation */
  .navbar { background: white; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
  .nav-container { max-width: 800px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; height: 56px; }
  .nav-link { color: var(--accent); text-decoration: none; font-size: 13px; font-weight: 600; }

  /* Layout */
  .container { max-width: 800px; margin: 32px auto; padding: 0 20px; }
  .step-label { font-size: 11px; font-weight: 700; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px; display: block; }
  
  /* Alert Banner */
  .alert { background: var(--info); border: 1px solid #d0e7ff; padding: 16px; border-radius: 8px; color: #2b78c5; font-size: 13px; line-height: 1.6; margin-bottom: 32px; }
  .alert b { color: var(--accent); }

  /* Config Card */
  .card { background: white; padding: 24px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 1px 2px rgba(0,0,0,0.04); margin-bottom: 24px; }
  .drop-zone { border: 2px dashed var(--border); border-radius: 8px; padding: 40px; text-align: center; color: #a1a1a1; cursor: pointer; background: #fafafa; transition: 0.2s; font-size: 14px; }
  .drop-zone:hover { border-color: var(--accent); color: var(--accent); background: #f0f7ff; }

  /* Form Fields */
  .fields { display: grid; grid-template-columns: 70px 1fr 1fr; gap: 12px; margin-top: 20px; }
  input { padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; width: 100%; box-sizing: border-box; outline: none; }
  input:focus { border-color: var(--accent); }
  
  .btn { background: var(--accent); color: white; border: none; padding: 14px; border-radius: 6px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.2s; margin-top: 16px; }
  .btn:hover { opacity: 0.9; }
  .btn-black { background: #000; margin-top: 8px; }

  /* Staging List */
  .staging-area { margin-top: 48px; }
  .temp-item { background: white; padding: 16px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 8px; display: flex; align-items: center; gap: 16px; position: relative; }
  .item-content { flex: 1; }
  .item-content b { font-size: 14px; display: block; margin-bottom: 2px; }
  .item-content small { color: var(--secondary); font-size: 12px; }
  .btn-remove { background: none; border: none; color: #eb5757; font-size: 12px; cursor: pointer; font-weight: 600; }
</style>
</head>
<body>

<nav class="navbar">
  <div class="nav-container">
    <a href="index.html" class="nav-link">‚Üê Portal</a>
    <span style="font-weight:700; font-size:14px">Library Configurator</span>
    <div style="width: 50px"></div>
  </div>
</nav>

<div class="container">
  <div class="alert">
    üí° <b>Strategy:</b> Encryption network blocked Supabase. 
    1. Place your PDFs in the <code>/files</code> folder.
    2. Add info below. 
    3. Export <code>data.json</code> and <b>Git Push</b> to update.
  </div>

  <span class="step-label">Step 1: File Detection</span>
  <div class="card">
    <div id="dropZone" class="drop-zone">Click or Drop PDF to Detect Info</div>
    <input type="file" id="fileInput" style="display:none" />
    
    <div class="fields">
      <input id="emoji" placeholder="Emoji" />
      <input id="displayName" placeholder="Display Name" />
      <input id="category" list="catOptions" placeholder="Category" />
      <datalist id="catOptions"></datalist>
    </div>
    <button class="btn" onclick="addToStaging()">Add to List</button>
  </div>

  <div class="staging-area">
    <span class="step-label">Step 2: Review & Export</span>
    <div id="staging"></div>
    <div id="actionBtns" style="display:none">
      <button class="btn btn-black" onclick="exportJSON()">Download data.json</button>
      <p style="text-align:center; font-size:11px; color:var(--secondary); margin-top:12px">
        Overwrite the <code>data.json</code> in your GitHub repo with this file.
      </p>
    </div>
  </div>
</div>

<script>
let staging = [];
const fileInput = document.getElementById('fileInput');
const dropZone = document.getElementById('dropZone');

// Detect Metadata
dropZone.onclick = () => fileInput.click();
fileInput.onchange = () => {
  const f = fileInput.files[0]; if(!f) return;
  dropZone.innerText = `Selected: ${f.name}`;
  document.getElementById('displayName').value = f.name.split('.').shift();
  const ext = f.name.split('.').pop().toLowerCase();
  const emojiMap = { 'pdf':'üìï', 'jpg':'üé®', 'png':'üñºÔ∏è', 'mp4':'üé¨', 'xlsx':'üìä' };
  document.getElementById('emoji').value = emojiMap[ext] || 'üìÑ';
};

// Manage List
function addToStaging() {
  const name = document.getElementById('displayName').value;
  const cat = document.getElementById('category').value;
  const em = document.getElementById('emoji').value;
  const f = fileInput.files[0];
  if(!name || !cat) return alert("Please fill Name and Category");

  staging.push({
    display_name: name,
    category: cat,
    emoji: em,
    url: `./files/${f ? f.name : name + '.pdf'}` // Direct GitHub Path
  });
  
  renderStaging();
  resetForm();
}

function renderStaging() {
  const container = document.getElementById('staging');
  document.getElementById('actionBtns').style.display = staging.length ? 'block' : 'none';
  
  container.innerHTML = staging.map((s, i) => `
    <div class="temp-item">
      <span style="font-size:24px">${s.emoji}</span>
      <div class="item-content">
        <b>${s.display_name}</b>
        <small>${s.category} ‚Ä¢ ${s.url}</small>
      </div>
      <button class="btn-remove" onclick="remove(${i})">Remove</button>
    </div>
  `).join('');
  
  // Update category datalist
  const cats = [...new Set(staging.map(s => s.category))];
  document.getElementById('catOptions').innerHTML = cats.map(c => `<option value="${c}">`).join('');
}

function remove(index) {
  staging.splice(index, 1);
  renderStaging();
}

function resetForm() {
  document.getElementById('displayName').value = "";
  document.getElementById('emoji').value = "";
  dropZone.innerText = "Click or Drop PDF to Detect Info";
}

function exportJSON() {
  const blob = new Blob([JSON.stringify(staging, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = window.URL.createObjectURL(blob);
  a.download = 'data.json';
  a.click();
}
</script>
</body>
</html>