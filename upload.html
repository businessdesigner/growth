<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Upload Files</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body { font-family: system-ui; background:#0f0f12; color:white; max-width:520px; margin:auto; padding:40px }
input, select, button { width:100%; padding:12px; margin-top:12px; border-radius:10px; border:none }
button { background:#6c7cff; color:white; font-weight:600; cursor:pointer }
.card { background:#16161d; padding:20px; border-radius:16px }
</style>
</head>
<body>

<h2>Upload to your library</h2>

<div class="card" id="loginBox">
  <input id="email" placeholder="your email" />
  <button onclick="login()">Send login link</button>
</div>

<div class="card" id="uploadBox" style="display:none">
  <input type="file" id="fileInput" />
  <input placeholder="Display name" id="displayName" />
  <input placeholder="Category (ex: Design, Finance)" id="category" />
  <button onclick="upload()">Upload</button>
  <p id="msg"></p>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

const supabase = createClient(
  "https://YOUR_PROJECT.supabase.co",
  "YOUR_PUBLISHABLE_KEY"
)

const loginBox = document.getElementById("loginBox")
const uploadBox = document.getElementById("uploadBox")

supabase.auth.onAuthStateChange((_, session) => {
  if (session) {
    loginBox.style.display = "none"
    uploadBox.style.display = "block"
  }
})

window.login = async () => {
  const email = document.getElementById("email").value
  await supabase.auth.signInWithOtp({ email })
  alert("Check your email")
}

window.upload = async () => {
  const file = fileInput.files[0]
  const displayName = displayNameInput.value || file.name
  const category = categoryInput.value || "Unsorted"

  const fileName = `${Date.now()}-${file.name}`

  document.getElementById("msg").innerText = "Uploading..."

  const { error } = await supabase.storage.from("files").upload(fileName, file)
  if (error) return msg.innerText = error.message

  await supabase.from("files").insert({
    storage_path: fileName,
    display_name: displayName,
    category
  })

  msg.innerText = "Uploaded âœ…"
}
</script>

</body>
</html>