<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cloud Exporter | Data Bridge</title>
    <link rel="stylesheet" href="../shared.css">
    <style>
        body { background: #F7F7F5; display: flex; flex-direction: column; min-height: 100vh; margin: 0; }
        .main-content { flex: 1; display: flex; align-items: center; justify-content: center; }
        .exporter-card { background: white; padding: 40px; border-radius: 16px; border: 1px solid var(--border-color); text-align: center; max-width: 400px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html" class="nav-brand">‚òÅÔ∏è Cloud Exporter</a>
            <div class="nav-links">
                <a href="upload.html" class="nav-item">Manage</a>
                <a href="../native/index.html" class="nav-item">Switch to GitHub Native</a>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <div class="exporter-card">
            <div class="file-emoji" style="margin-bottom: 16px;">üîÑ</div>
            <h2 style="font-size: 20px; margin: 0 0 12px 0;">Generate Static Data</h2>
            <p style="color:var(--text-secondary); font-size: 14px; margin-bottom: 32px;">
                Download the latest database state as <code>data.json</code> to update your Native Library.
            </p>
            <button id="exportBtn" class="btn">Download data.json</button>
            <p style="margin-top: 24px; font-size: 12px; color: #BBB;">
                Note: This version uses Supabase URLs. For offline access, use the Native Configurator.
            </p>
        </div>
    </div>

    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
        const supabase = createClient("https://cvuigmevznxkgnmleuta.supabase.co", "sb_publishable_jbiNfw9ST_LSxlYuDNR3Ag_RymggO6q")

        document.getElementById('exportBtn').onclick = async () => {
            const btn = document.getElementById('exportBtn');
            btn.innerText = "Processing...";
            
            const { data, error } = await supabase.from("files").select("*");
            if (error) { alert("Error fetching data: " + error.message); return; }

            const exportData = data.map(f => {
                const { data: { publicUrl } } = supabase.storage.from("Files").getPublicUrl(f.storage_path);
                return {
                    display_name: f.display_name,
                    category: f.category,
                    emoji: f.emoji,
                    url: publicUrl 
                };
            });

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = window.URL.createObjectURL(blob);
            a.download = 'data.json';
            a.click();
            
            btn.innerText = "Download data.json";
        };
    </script>
</body>
</html>