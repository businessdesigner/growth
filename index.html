<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg: #ffffff; --text: #37352f; --border: #edeef0; --secondary: #757575; --accent: #2383e2; --tag-bg: #f1f1ef; }
  body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; -webkit-font-smoothing: antialiased; }
  
  /* Grid System & Header */
  .navbar { border-bottom: 1px solid var(--border); background: white; position: sticky; top: 0; z-index: 10; }
  .nav-container, .container { max-width: 900px; margin: 0 auto; padding: 0 20px; box-sizing: border-box; }
  .nav-container { display: flex; justify-content: space-between; align-items: center; height: 60px; }
  .logo { font-weight: 700; font-size: 16px; display: flex; align-items: center; gap: 8px; }
  
  /* UI Elements */
  .btn-primary { background: var(--accent); color: white; text-decoration: none; padding: 8px 14px; border-radius: 6px; font-size: 14px; font-weight: 500; }
  .filter-bar { display: flex; gap: 8px; margin: 32px 0; flex-wrap: wrap; }
  .filter-btn { border: 1px solid var(--border); background: white; padding: 6px 14px; border-radius: 20px; font-size: 13px; cursor: pointer; color: var(--secondary); transition: 0.2s; }
  .filter-btn.active { background: var(--text); color: white; border-color: var(--text); }
  
  /* 3-Column Grid */
  .file-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 60px; }
  .card { background: white; padding: 16px; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; transition: all 0.2s cubic-bezier(0.05,0,0,1); display: flex; flex-direction: column; gap: 10px; }
  .card:hover { border-color: #d3d3d3; background: #fbfbfb; transform: translateY(-1px); }
  .file-emoji { font-size: 28px; }
  .file-name { font-weight: 600; font-size: 14px; line-height: 1.4; color: var(--text); overflow: hidden; text-overflow: ellipsis; display: -webkit-box; display: -webkit-box;
  -webkit-line-clamp: 2;  -webkit-box-orient: vertical;  line-clamp: 2; /* é€™æ˜¯ VS Code å»ºè­°å¢žåŠ çš„æ¨™æº–å±¬æ€§ */ overflow: hidden;}
  .badge { align-self: flex-start; background: var(--tag-bg); color: var(--secondary); padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }

  @media (max-width: 768px) { .file-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 480px) { .file-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<nav class="navbar">
  <div class="nav-container">
    <div class="logo">ðŸ“„ My Library</div>
    <a href="upload.html" class="btn-primary">+ Add New</a>
  </div>
</nav>

<div class="container">
  <div id="filterBar" class="filter-bar">
    <button class="filter-btn active" data-cat="All">All</button>
  </div>

  <div id="app" class="file-grid"></div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
const supabase = createClient("https://cvuigmevznxkgnmleuta.supabase.co", "sb_publishable_jbiNfw9ST_LSxlYuDNR3Ag_RymggO6q")

let allFiles = [];

async function init() {
  const { data } = await supabase.from("files").select("*").order("created_at", {ascending:false});
  allFiles = data || [];
  
  renderFilters();
  renderFiles("All");
}

function renderFilters() {
  const categories = ["All", ...new Set(allFiles.map(f => f.category))];
  const filterBar = document.getElementById("filterBar");
  filterBar.innerHTML = categories.map(cat => `
    <button class="filter-btn ${cat === 'All' ? 'active' : ''}" data-cat="${cat}">${cat}</button>
  `).join('');

  filterBar.querySelectorAll('.filter-btn').forEach(btn => {
    btn.onclick = () => {
      filterBar.querySelector('.active').classList.remove('active');
      btn.classList.add('active');
      renderFiles(btn.dataset.cat);
    };
  });
}

function renderFiles(filter) {
  const app = document.getElementById("app");
  const filtered = filter === "All" ? allFiles : allFiles.filter(f => f.category === filter);
  
  app.innerHTML = filtered.map(f => {
    const { data:url } = supabase.storage.from("Files").getPublicUrl(f.storage_path);
    return `
      <div class="card" onclick="window.open('${url.publicUrl}')">
        <div class="file-emoji">${f.emoji || 'ðŸ“„'}</div>
        <div class="file-name">${f.display_name}</div>
        <div class="badge">${f.category}</div>
      </div>
    `;
  }).join('');
}

init();
</script>
</body>
</html>