<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Library</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg: #ffffff; --text: #37352f; --border: #edeef0; --secondary: #757575; --accent: #2383e2; }
  body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
  .navbar { display: flex; justify-content: space-between; align-items: center; padding: 16px 40px; border-bottom: 1px solid var(--border); }
  .container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; }
  h2 { font-size: 14px; text-transform: uppercase; color: var(--secondary); margin: 40px 0 16px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
  /* ‰∏âÊ¨ÑÂºè‰ΩàÂ±Ä */
  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
  .card { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); cursor: pointer; transition: transform 0.1s, box-shadow 0.1s; display: flex; flex-direction: column; gap: 8px; }
  .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
  .file-emoji { font-size: 32px; margin-bottom: 4px; }
  .file-name { font-weight: 600; font-size: 15px; word-break: break-all; }
  .tag { font-size: 12px; color: var(--secondary); }
  @media (max-width: 768px) { .grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 480px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<nav class="navbar">
  <div style="font-weight:700">üìÑ My Library</div>
  <a href="upload.html" style="background:var(--accent); color:white; text-decoration:none; padding:6px 16px; border-radius:6px; font-size:14px">Manage</a>
</nav>

<div class="container" id="app"></div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"
const supabase = createClient("https://cvuigmevznxkgnmleuta.supabase.co", "sb_publishable_jbiNfw9ST_LSxlYuDNR3Ag_RymggO6q")

const { data } = await supabase.from("files").select("*").order("created_at", {ascending:false})

if (data) {
  const groups = {};
  data.forEach(f => (groups[f.category] ||= []).push(f));
  
  const app = document.getElementById("app");
  for (const cat in groups) {
    const section = document.createElement('div');
    section.innerHTML = `<h2>${cat}</h2><div class="grid" id="g-${cat}"></div>`;
    app.appendChild(section);
    
    groups[cat].forEach(f => {
      const { data:url } = supabase.storage.from("Files").getPublicUrl(f.storage_path);
      document.getElementById(`g-${cat}`).innerHTML += `
        <div class="card" onclick="window.open('${url.publicUrl}')">
          <div class="file-emoji">${f.emoji || 'üìÑ'}</div>
          <div class="file-name">${f.display_name}</div>
          <div class="tag">${new Date(f.created_at).toLocaleDateString()}</div>
        </div>
      `;
    });
  }
}
</script>
</body>
</html>